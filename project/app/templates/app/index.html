{% extends 'app/base.html' %}

{% block content %}
<div class="container">
    <div class="stats-section">
        <div class="stats-card">
            <h2>Решено проблем</h2>
            <div class="counter" id="solved-counter">{{ solved_count }}</div>
        </div>
    </div>

    <div class="recent-solutions">
        <h2>Последние решенные проблемы</h2>
        <div class="solutions-grid">
            {% for problem in solved_problems %}
            <div class="solution-card">
                <div class="solution-header">
                    <h3>{{ problem.title }}</h3>
                    <span class="category-badge">{{ problem.category.name }}</span>
                </div>
                
                <div class="solution-images">
                    <div class="image-comparison">
                        <div class="image-wrapper after">
                            <img src="{{ problem.image_after.url }}" alt="После" class="comparison-image">
                            <span class="image-label">После</span>
                        </div>
                        <div class="image-wrapper before">
                            <img src="{{ problem.image_before.url }}" alt="До" class="comparison-image">
                            <span class="image-label">До</span>
                        </div>
                    </div>
                </div>

                <div class="solution-info">
                    <p class="solution-description">{{ problem.description }}</p>
                    <p class="solution-date">Решено: {{ problem.updated_at|date:"d.m.Y" }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<style>
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    .stats-section {
        margin-bottom: 40px;
    }

    .stats-card {
        background: linear-gradient(135deg, #4CAF50, #45a049);
        color: white;
        padding: 30px;
        border-radius: 15px;
        text-align: center;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .stats-card h2 {
        margin: 0;
        font-size: 1.5em;
        font-weight: 500;
    }

    .counter {
        font-size: 3em;
        font-weight: bold;
        margin-top: 10px;
    }

    .solutions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .solution-card {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s;
    }

    .solution-card:hover {
        transform: translateY(-5px);
    }

    .solution-header {
        padding: 15px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .solution-header h3 {
        margin: 0;
        font-size: 1.2em;
    }

    .category-badge {
        background: #e9ecef;
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 0.9em;
        color: #495057;
    }

    .solution-images {
        position: relative;
        height: 200px;
    }

    .image-comparison {
        position: relative;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }

    .image-wrapper {
        position: absolute;
        width: 100%;
        height: 100%;
        transition: opacity 0.5s ease-in-out;
    }

    .image-wrapper.before {
        opacity: 0;
    }

    .image-comparison:hover .image-wrapper.before {
        opacity: 1;
    }

    .comparison-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .image-label {
        position: absolute;
        bottom: 10px;
        left: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 0.9em;
    }

    .solution-info {
        padding: 15px;
    }

    .solution-description {
        margin: 0 0 10px 0;
        color: #666;
    }

    .solution-date {
        margin: 0;
        color: #999;
        font-size: 0.9em;
    }

    @media (max-width: 768px) {
        .solutions-grid {
            grid-template-columns: 1fr;
        }

        .solution-images {
            height: 150px;
        }
    }
</style>

<script>
    // Обновление счетчика каждые 5 секунд
    function updateCounter() {
        fetch('/api/solved-count/')
            .then(response => response.json())
            .then(data => {
                const counter = document.getElementById('solved-counter');
                const currentCount = parseInt(counter.textContent);
                const newCount = data.count;
                
                if (currentCount !== newCount) {
                    // Анимация счетчика
                    counter.style.transform = 'scale(1.2)';
                    counter.style.color = '#4CAF50';
                    setTimeout(() => {
                        counter.textContent = newCount;
                        counter.style.transform = 'scale(1)';
                        counter.style.color = 'white';
                    }, 200);
                }
            });
    }

    // Запускаем обновление каждые 5 секунд
    setInterval(updateCounter, 5000);

    // Добавляем анимацию появления карточек
    document.addEventListener('DOMContentLoaded', function() {
        const cards = document.querySelectorAll('.solution-card');
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, {
            threshold: 0.1
        });

        cards.forEach(card => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            observer.observe(card);
        });
    });
</script>
{% endblock %}